# 불변성

불변성이란 값이나 상태를 변경할 수 없는 것을 의미합니다.

## React에서 불변성 ?

React에서 불변성을 지키는 이유를 보면 리액트에서 상태 업데이트를 하는 원리 때문

리액트는 상태값을 업데이트 할 때 **얕은 비교를 수행**합니다. 즉 객체의 속성 하나하나를 비교하는게 아니라 참조값만 비교하여 상태 변화를 감지합니다.

따라서 Object or Array의 속성이나 값을 바꾸는 불변성이 없는 변경은 상태가 바뀌었다고 React에서 파악을 못하기 때문에 이런 불변성을 지키는 업데이트가 필요합니다

그러므로 배열이나 객체를 새로 생성해서 새로운 참조값을 만들어서 상태를 업데이트 합니다.

이렇게 불변성을 지켜줌으로써 또 다른 이점은 바로 사이드 이펙트를 방지하는 것. 즉 **외부에 존재하는 원본데이터를 직접 수정하지 않고, 원본데이터의 복사본을 만들어서 값을 사용하기에 예상치 못한 오류를 사전에 방지할 수 있습니다.** 다시 반대로 생각해보면 외부의 값을 함부로 변경할 수 있는 것은 위험한 일입니다. 만약 다른 어떤 곳에서 원본데이터를 사용하고 있다고 하면 어플리케이션 어딘가에서 사이드 이펙트가 일어날 가능성이 있기 때문입니다.

## 불변성을 지키지 않으면?

React 에서는 얕은 비교를 통해 새로운 값인지 아닌지를 판단 한 후, 만약 새로운 값임을 판단하게 되면 부모 컴포넌트가 리렌더링을 하면 자식 컴포넌트도 함께 리렌더링 된다.

만약 어떠한 컴포넌트를 리렌더링 하고 싶을 때 배열 타입인 state가 있다고 가정하자.
`state.push(10)`을 통해서 배열에 직접 10이라는 값을 추가한다.

React에서는 해당 state라는 값은 새로운 참조값으로 바뀐것이 아니기 때문에 push 이전의 state와 push 이후의 state가 같다고 판단하여 리렌더링을 하지 않게 된다.
객체 경우에는

```
const myObj = {
a: 1
}

myObj.a = 2
```

'myObj'의 내부 프로퍼티의 값을 변경한다 가정했을 때
myObj에서 참조하고 있는 'a'값은 변경되지 않고 값이 변경된다. 단, 'a'가 참조하고 있는 '1'의 주소 값은 변경된다.

**이러한 이유 때문에 state 값을 변경하고 React에게 리렌더링을 원한다고 알리고 싶다면 새로운 배열을 생성해서 새로운 참조값을 생성하고 그 안에 기존의 값을 넣어줘야 한다!**

---

### 참고

- https://velog.io/@jma1020/%EB%A6%AC%EC%95%A1%ED%8A%B8%EC%97%90%EC%84%9C-%EB%B6%88%EB%B3%80%EC%84%B1%EC%9D%B4%EB%9E%80
