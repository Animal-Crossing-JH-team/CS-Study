# 브라우저의 렌더링

<hr/>

> **브라우저의 렌더링 과정**

<img src="https://velog.velcdn.com/images/wlwl99/post/fe53369c-28b0-446d-bbfe-68ca6e92e67f/image.png
" alt="">

1. HTML 파싱 (Parsing):
   브라우저는 웹 페이지의 HTML 코드를 읽어 DOM 트리를 구성

2. CSS 파싱:
   브라우저는 CSS 스타일 시트를 파싱하여 CSSOM (CSS Object Model) 트리를 구성
   (CSSOM은 문서의 스타일 정보를 표현하는 트리 구조)

3. Render Tree 생성:
   DOM 트리와 CSSOM 트리를 결합하여 Render Tree를 생성
   (Render Tree는 실제로 화면에 렌더링되는 요소들로 이루어진 트리 구조, 레이아웃과 스타일 정보가 포함)

4. 레이아웃 (Layout) 계산:
   브라우저는 렌더 트리를 기반으로 각 요소들의 위치와 크기 등 레이아웃을 계산
   (레이아웃 계산은 DOM 요소들의 스타일 정보, 위치, 크기 등을 고려하여 요소들이 어떻게 배치되어야 할지 결정)

5. 페인팅 (Painting):
   레이아웃이 계산되면, 브라우저는 각 요소들을 화면에 표시
   (렌더링 엔진은 레이아웃 계산에서 결정된 스타일과 위치 정보를 이용하여 화면에 픽셀을 그림)

<hr />

> **리플로우(Reflow) & 리페인트(Repaint)**

자바스크립트 코드에 DOM이나 CCSOM을 변경하는 DOM API가 사용된 경우 DOM이나 CSSOM이 변경되며, 이때 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합되고 변경된 렌더 트리를 기반으로 레이아웃과 페인트 과정을 거쳐 브라우저의 화면에 다시 렌더링

1. **리플로우(Reflow)**
   DOM 요소의 크기, 위치, 또는 레이아웃에 영향을 주는 스타일 변경이 발생 시 레이아웃 계산을 다시 수행하는 과정

2. **리페인트(Repaint)**
   스타일의 변경이나 투명도, 배경색 등 화면에 영향을 주는 스타일 속성이 변경이 발생 시 렌더링 트리의 일부 혹은 전체를 다시 그리는 작업

레이아웃 변경이 있으면 리플로우가 발생하고, 스타일 변경이 있으면 리페인트가 발생

<hr/>

> **브라우저 렌더링 최적화**

1. Javascript 최적화
2. 자바스크립트 로드 방식 변경:
   script 태그를 body 태그의 가장 아래에 위치시켜 페이지의 HTML과 CSS가 먼저 렌더링
3. 코드 스플리팅(Codoe Splitting):
   자바스크립트 코드를 여러 개의 작은 번들로 분리하여, 초기 로딩에 필요한 부분만 로드
4. 이미지 및 CSS 최적화
5. 서버 사이드 렌더링(SSR)

<hr/>

> **script 태그를 body 태그 밑에 둬야하는 이유**

렌더링 엔진은 HTML을 한 줄씩 순차적으로 파싱하여 DOM을 생성해 나가다가 자바스크립트 파일을 로드하는 script 태그나 자바스크립트 코드를 만나면 DOM 생성을 일시 중단 후 JavaScript 코드를 파싱하기 위해 자바스크립트 엔진에 제어권을 넘긴다. 따라서 script 태그를 상단에 위치시키면, 자바스크립트 파일을 다운로드하고 실행하는 동안 사용자는 빈 화면을 보게 되며, 화면이 느리게 로딩되는 느낌을 주게 될 수 있다.

<hr/>

> **script 태그의 async/defer 어트리뷰트**

JavaScript 파싱에 의한 DOM 생성이 중단되는 문제를 해결하기 위해 HTML5부터 script 태그에 async와 defer 속성이 추가

```javaScript
<script async src="extern.js"></script>
<script defer src="extern.js"></script>

//단, src 속성에 지정된 파일은 웹 서버나 CDN과 같은 네트워크 상에 위치한 파일
```

두 속성 다 HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 진행 하지만,
async는 파싱과 실행이 자바스크립트 파일의 로드가 완료된 후 진행
defer는 DOM 생성이 완료된 후 진행
