# 자바스크립트 엔진(JavaScript Engine)

- 자바스크립트 엔진은 자바스크립트 코드를 해석하고 실행하는 인터프리터이다.
- 대중적으로 알려진 엔진은 구글의 V8엔진 (크롬, node.js)

브라우저마다 다른 엔진을 사용

```
Rhino - 모질라
SpiderMonkey - 파이어폭스
V8 - 구글, 오페라
JavascriptCore - 사파리
Chakra - 익스플로러, 마이크로소프트 엣지
```

자바스크립트 엔진은 메모리 힙과 호출 스택으로 이루어져 있다.

- `메모리 힙` : 변수와 객체의 메모리 할당이 발생하는 곳
- `콜 스택` : 코드가 실행될 때마다 호출 스택이 쌓이는 곳
  <img src="https://velog.velcdn.com/images%2Fru_bryunak%2Fpost%2F79a826fb-e84c-4e28-b049-609af759ff63%2Fjs-engine-structure.png">

## JS 엔진의 해석 순서

아래는 V8의 예시, 일반적으로 엔진마다 다소 차이는 있지만 대략 이런 흐름으로 진행된다고 생각하면 된다.

1. HTML 파서가 HTML 소스에서 `<Script>` 태그를 만난다.

   - 브라우저는 스크립트 엔진, 렌더링 엔진 등 다양한 엔진을 가지고 있고 실행은 항상 동시에 일어나지 않을 수 있다. (JS 없이 HTML만 코드를 짤 수도 있기 때문)
   - HTML 파서가 `<Script>` 태그를 만나면 내용을 분석

2. 자바스크립트 소스 코드가 파싱된다.

   - `<Script>` 태그 이후 사용자가 작성한 소스 코드의 어휘와 문법을 분석하는 작업 진행 -> 파싱된 자료를 통해 노드 생성

3. 파싱된 자료를 이용해 AST(Abstract Syntax Tree)를 생성.

   - 파싱의 결과물로 나온 노드들을 모아서 '추상 구문 트리' 즉 AST를 만든다.
     - AST에서 각 노드는 소스 코드에서 발생되는 구조를 나타낸다. (참고로 AST는 컴파일러에서 많이 쓰인다. 이는 코드 구조를 표현하는 프로퍼티이기 때문이다.)

4. AST를 인터프리터를 통해 바이트 코드로 바꿈.

   - AST의 노드들은 인터프리터를 통해 가상 머신이 이해하기 쉽게 만든 중간 코드인 'Bytecode'로 변환됨.

5. 자주 쓰는 구문을 최적화를 위해 컴파일한다.

   - 인터프리터를 통해 해석된 바이트 코드 중 자주 쓰는 구문은 '터보팬'이라 이름 붙은 최적화를 맡은 컴파일러에 전달된다.
   - 터보팬은 호출 빈도가 많은 구문을 컴파일해서 'Optimized Machine Code' 라는 최적화된 코드로 만든다. (이때 히든클래스, 인라인 캐싱 같은 다양한 기법을 사용)

6. '바이트코드'와 '최적화코드'
   - 앞서 V8은 AST를 통해 기본적으로 인터프리터 방식으로 '바이트코드'를 만든 후 자주쓰는 구문은 최적화 컴파일러를 통해 '최적화코드'를 만들었다.
   - 그리고 이제 이 둘이 번갈아가면서 기존에 '바이트코드'를 CPU에 전달하다가 자주쓰는 구문의 구간이 오면 미리 준비해둔 '최적화코드'를 CPU로 전달하게 되는 것 (전달될 때는 기계어로 번역되어 전달)

```
파싱 → AST 구성 → 인터프리터로 '바이트코드' 생성 → 자주쓰는 구문은 최적화 컴파일러로 전달하여 '최적화 코드'를 생성→ 둘을 번갈아가면 사용
```

<hr>

## 렌더링 엔진이란?

웹 렌더링 엔진(Web Rendering Engine) 또는 웹 브라우저 엔진(Web Browser Engine) 또는 웹 레이아웃 엔진(Web Layout Engine)이라고 불린다.

- 렌더링, 브라우저, 레이아웃 단어 그대로 웹 페이지에 대한 컨텐츠 및 데이터를 위해 동작하는 엔진이다.
- 렌더링 역할을 하는 엔진이 브라우저마다 다르기 때문에 같은 페이지가 다르게 보이는 경우가 있다.

JS 엔진과 마찬가지로 브라우저마다 다른 엔진 사용

```
Gecko - 모질라, 파이어폭스
Blink - 구글, 오페라
Webkit - 사파리
Trident - 익스플로러
EdgeHTML - 마이크로소프트 엣지
```

<hr>

### 참고

- https://sgcomputer.tistory.com/173
- https://velog.io/@ru_bryunak/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EA%B8%B0%EC%B4%88-1
