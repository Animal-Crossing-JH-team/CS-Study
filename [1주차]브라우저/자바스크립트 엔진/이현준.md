# 자바스크립트 엔진

<hr/>

> **자바스크립트 엔진 동작 과정 (V8 기준)**

<img src="https://velog.velcdn.com/images%2Fnamezin%2Fpost%2F0c64e3d1-e9eb-4295-9bb1-d5ce42c6d4f7%2Fv8.png
" alt="동작 그림">

1. 소스 코드 파싱:
   자바스크립트 엔진은 소스 코드를 받아서 파싱

2. AST(Abstract Syntax Tree) 생성:
   파싱된 결과로부터 추상 구문 트리(AST)를 생성

3. Ignition을 통한 바이트 코드 생성:
   생성된 AST를 바탕으로 인터프리터인 Ignition이 동작 Ignition은 AST를 바이트 코드로 변환하고, 이를 실행하는 역할을 담당

(바이트 코드는 중간 코드로 컴파일되어 기계어보다는 더 추상적인 형태의 코드)

4. 바이트 코드 실행:
   변환된 바이트 코드를 실행하여 프로그램을 동작, 인터프리터가 바이트 코드를 한 줄씩 실행하면서 프로그램 동작

5. TurboFan 최적화:
   실행 중에 자주 사용되는 코드는 인터프리터에 의해 추적, 추적된 코드는 최적화를 위해 TurboFan으로 전달
   TurboFan은 추적된 코드를 분석하고, 최적화 기법을 적용하여 Optimized Machine Code(기계어)로 변환.
   이로 인해 빠르고 효율적인 코드 실행이 가능

6. Optimized Machine Code 실행:
   최적화된 기계어 코드인 Optimized Machine Code를 실행하여 자바스크립트 프로그램이 더욱 빠르고 효율적으로 동작

<hr>

**추상적인 구문이란?**
예를 들어, 자바스크립트의 "let 변수이름 = 값;"과 같은 형태로 작성된 코드는 사람이 이해하기 쉬운 형태이지만, 컴퓨터는 이러한 코드를 직접적으로 처리하기 어렵기 때문에
하기와 같이 코드의 구조와 의미를 파악하기 쉬운 형태로 표현 하는 것

```bash
//AST(Abstract Syntax Tree)의 예시
{
  type: 'VariableDeclaration',
  kind: 'let',
  declarations: [
    {
      type: 'VariableDeclarator',
      id: {
        type: 'Identifier',
        name: 'x'
      },
      init: {
        type: 'Literal',
        value: 10
      }
    }
  ]
}
```

<br>

**아니 그러면 진작에 Optimized Machine Code로 변경 시키면 되는거 아니야?**

바이트 코드를 생성하여 인터프리터에 의해 실행하는 방법은 빠르게 시작할 수 있고, 소스 코드를 빠르게 해석하여 바로 실행할 수 있는 장점이 있으나 인터프리터는 일반적으로 기계어에 비해 상대적으로 느린 실행 속도를 가지기 때문에, 코드 실행이 더 느릴 수 있다.

반면 최적화된 기계어 코드를 생성하여 실행하는 방법은 바이트 코드에 비해 실행 속도가 빠르며, 더 효율적으로 동작할 수 있다. 이러한 최적화는 바이트 코드보다 코드 실행 속도를 향상시키지만, 최적화된 기계어 코드를 생성하는 과정은 더 많은 시간과 자원을 필요로 하기 때문에, 코드 실행 전에 미리 최적화를 수행하는 것이 아니라 실행 중에 추적된 코드를 최적화하는 방식으로 동작

즉, 생성: 바이트 코드 > 기계어 코드, 속도: 바이트 코드 < 기계어 코드

<hr />

> **자바스크립트 엔진 메모리 관리**

<img src="https://joshua1988.github.io/images/posts/web/translation/how-js-works/js-engine-structure.png" alt="엔진 그림">

1. 콜 스택 (Call Stack):
   콜 스택은 함수 호출과 관련된 정보를 저장하는 메모리 영역, 실행 컨텍스트를 스택 형태로 관리

함수가 호출되면 해당 함수의 실행 컨텍스트가 스택의 맨 위에 쌓이고, 함수의 실행이 완료되면 해당 실행 컨텍스트가 스택에서 제거, 이렇게 콜 스택은 현재 실행 중인 함수와 함수 호출 관계를 추적

2. 힙 (Heap):
   힙은 동적으로 할당된 데이터가 저장되는 메모리 영역으로 객체, 배열, 함수 등의 데이터 타입이 힙에 할당, 힙은 자바스크립트에서 사용되는 모든 객체들이 저장되는 공간이며 힙에 할당된 메모리는 자바스크립트 엔진이 자동으로 관리

3. 가비지 컬렉션(Garbage Collection):
   해당 메커니즘을 통해 더 이상 사용되지 않는 객체들은 자동으로 메모리에서 해제
